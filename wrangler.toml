# Updated worker manifest to match required Cloudflare config
name = "my-chat-agent-v2"
main = "worker.js"
compatibility_date = "2024-11-12"
workers_dev = true

# REQUIRED: Cloudflare account information for Wrangler â†’ Cloudflare sync
account_id = "59fea97fab54fbd4d4168ccaa1fa3410"

[vars]
# Provider routing
PROVIDER = "groq"
PROVIDER_URL = "https://api.groq.com/openai/v1/chat/completions"
PROVIDER_MODEL = "llama-3.1-8b-instant"

# Response limits (both names for compatibility)
MAX_OUTPUT_TOKENS = "1400"
MAX_TOKENS = "1400"

# Fully approved frontend origins
CORS_ORIGINS = "https://reflectivei.github.io,https://reflectivei.github.io/reflectiv-ai,https://reflectivai.github.io,https://tonyabdelmalak.github.io,https://tonyabdelmalak.com,https://reflectivai.com,https://www.reflectivai.com,https://www.tonyabdelmalak.com,https://dash.cloudflare.com,https://my-chat-agent-v2.tonyabdelmalak.workers.dev"

# Secrets (store via `wrangler secret put` or Cloudflare dashboard)
# wrangler secret put PROVIDER_KEY
# wrangler secret put PROVIDER_KEY_2
# wrangler secret put PROVIDER_KEY_3

# PROVIDER_KEY must be set as a secret using:
# wrangler secret put PROVIDER_KEY
# The secret value should be your GROQ API key starting with "gsk_..."

[env.staging]
name = "my-chat-agent-v2-staging"
workers_dev = true

[env.staging.vars]
PROVIDER = "groq"
PROVIDER_URL = "https://api.groq.com/openai/v1/chat/completions"
PROVIDER_MODEL = "llama-3.1-8b-instant"
MAX_OUTPUT_TOKENS = "1400"
MAX_TOKENS = "1400"
CORS_ORIGINS = "https://reflectivei.github.io,https://reflectivei.github.io/reflectiv-ai,https://reflectivai.github.io,https://tonyabdelmalak.github.io,https://tonyabdelmalak.com,https://reflectivai.com,https://www.reflectivai.com,https://www.tonyabdelmalak.com,https://dash.cloudflare.com,https://my-chat-agent-v2-staging.tonyabdelmalak.workers.dev"

[[env.staging.kv_namespaces]]
binding = "SESS"
id = "75ab38c3bd1d4c37a0f91d4ffc5909a7"
preview_id = "75ab38c3bd1d4c37a0f91d4ffc5909a7"

[[env.staging.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "05082ad512db483da5587785831e033e"
preview_id = "05082ad512db483da5587785831e033e"

[[kv_namespaces]]
binding = "SESS"
id = "75ab38c3bd1d4c37a0f91d4ffc5909a7"
# preview_id can repeat id for dev
preview_id = "75ab38c3bd1d4c37a0f91d4ffc5909a7"

[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "05082ad512db483da5587785831e033e"
# Preview id can reuse the production namespace value
preview_id = "05082ad512db483da5587785831e033e"

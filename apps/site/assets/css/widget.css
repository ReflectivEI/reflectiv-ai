/* =========================================================
   ReflectivAI — Coach Widget (Highspot-aligned)
   SAFE with widget.js @ af269804. No selector renames.
   Palette: Navy #0c2740, Teal #20bfa9, Ink #1e2a3a, Soft #ecf3fb, Lines #d9e3ef
   ========================================================= */

/* ---------- Vars ---------- */
:root{
  /* Core theme variables (required by new widget modules) */
  --accent:#20bfa9;
  --radius:12px;
  --ink:#1e2a3a;
  --line:#d9e3ef;
  --soft:#ecf3fb;
  
  /* Extended palette */
  --navy:#0c2740;
  --slate:#596a82;
  --teal:#20bfa9;
  --teal-2:#17a895;
  --soft-2:#f7f9fc;
  --warn:#fff7d8;
  --danger:#ffebe8;
  --card:#ffffff;
  --shadow-sm:0 4px 14px rgba(12,39,64,.10);
  --shadow:0 12px 28px rgba(12,39,64,.14);
  --radius-lg:16px;
  --pad:14px;
}

/* ---------- Scope text defaults for mounts ---------- */
.reflectiv-chat,
.reflectiv-coach,
#reflectiv-coach,
#reflectiv-widget {
  font-family:"Inter","Poppins",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
  color:var(--ink);
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
}

/* =================================================================
   MODAL + PANEL
   ================================================================= */
.coach-modal{
  position:fixed;inset:0;
  display:none;place-items:start center;
  padding:32px 12px;
  background:rgba(10,18,28,.38);
  z-index:9999;
}
.coach-modal.open,.coach-modal.is-open{display:grid}
.coach-panel{
  width:min(980px,96vw);
  background:var(--card);
  border:1px solid var(--line);
  border-radius:var(--radius-lg);
  box-shadow:var(--shadow);
  overflow:hidden;
}

/* Header */
.coach-header{
  display:flex;align-items:center;justify-content:space-between;gap:8px;
  padding:12px 16px;background:var(--soft-2);
  border-bottom:1px solid var(--line);
}
.coach-title{font:800 18px/1 "Inter";color:var(--navy)}
.coach-close{
  appearance:none;border:1px solid var(--line);background:#fff;color:var(--ink);
  border-radius:999px;padding:6px 12px;font-weight:700;cursor:pointer;
}
.coach-close:hover{background:#f9fbfe}

/* =================================================================
   TOOLBAR / CONTROLS
   ================================================================= */
.chat-toolbar,.sim-controls{
  display:grid;grid-template-columns:repeat(4,minmax(160px,1fr));
  gap:10px;align-items:end;padding:12px 16px;background:var(--soft-2);
  border-bottom:1px solid var(--line);
}
@media (max-width:900px){.chat-toolbar,.sim-controls{grid-template-columns:repeat(2,1fr)}}
@media (max-width:520px){.chat-toolbar,.sim-controls{grid-template-columns:1fr}}

.chat-toolbar label,.sim-controls label{
  display:block;margin:0 0 6px;color:var(--navy);
  font:700 12px/1.2 "Inter";
}
.chat-toolbar select,.sim-controls select{
  width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;
  background:#fff;font:400 14px/1.2 "Inter";color:var(--ink);
}
.chat-toolbar .hint{font:600 12px/1.2 "Inter";color:var(--slate)}

/* =================================================================
   SCENARIO / BRIEF / GUIDANCE
   ================================================================= */
.simulation,
.scenario-brief {
  padding: 16px 18px;
  background: #fff;
  border-bottom: 1px solid var(--line);
  line-height: 1.5;
}

/* Bold section headers inside coach cards */
.simulation strong,
.scenario-brief strong {
  display: block;
  margin-bottom: 4px;
  color: #0b3954;
  font-weight: 800;
}

/* Add bold "Suggested Phrasing:" label before the final quoted paragraph */
.simulation p:last-of-type::before {
  content: "Suggested Phrasing: ";
  font-weight: 800;
  color: #0b3954;
}

.guidance,
.brief-card {
  margin: 14px 16px;
  background: var(--soft);
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 12px 14px;
  color: var(--ink);
}

.guidance h4,
.brief-card h4 {
  margin: 0 0 6px;
  font: 800 14px/1.2 "Inter";
  color: #0b3954;
}

/* Collapsible rubric (if JS injects it) */
.rubric {
  margin: 10px 16px;
  border: 1px dashed var(--line);
  border-radius: 10px;
  background: #fcfdff;
}
.rubric summary {
  cursor: pointer;
  padding: 8px 10px;
  font: 700 13px/1.2 "Inter";
  color: #0b3954;
}
.rubric div {
  padding: 8px 10px 10px;
  font: 400 13px/1.5 "Inter";
  color: var(--ink);
}

/* =================================================================
   MESSAGES
   ================================================================= */
.chat-messages {
  max-height: 48vh;
  overflow: auto;
  padding: 16px 18px;
  background: #fff;
}
.chat-message {
  margin: 0 0 12px;
  line-height: 1.45;
  color: var(--ink);
}
.chat-message.user {
  text-align: right;
  color: #0b3954;
}
.chat-message.bot {
  text-align: left;
  color: var(--ink);
}

/* Inline code and quotes inside messages */
.chat-message code {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
    "Liberation Mono", "Courier New", monospace;
  font-size: 0.92em;
  background: #f6f8fb;
  border: 1px solid var(--line);
  padding: 2px 6px;
  border-radius: 6px;
}
.chat-message blockquote {
  margin: 6px 0;
  padding: 6px 10px;
  border-left: 3px solid var(--line);
  background: #fbfdff;
  border-radius: 6px;
}

/* Bot cards (optional, if JS prints) */
.msg-card {
  border: 1px solid var(--line);
  border-radius: 12px;
  background: #fff;
  padding: 10px 12px;
  box-shadow: var(--shadow-sm);
}

/* =================================================================
   INPUT
   ================================================================= */
.chat-input{
  display:flex;gap:10px;align-items:stretch;
  padding:14px 16px;border-top:1px solid var(--line);background:#f9fbfe;
}
.chat-input textarea{
  flex:1;min-height:44px;resize:none;border:1px solid var(--line);border-radius:12px;
  padding:10px 12px;font:400 14px/1.3 "Inter";color:var(--ink);
}
.chat-input .send-btn,.chat-input button{
  border:0;border-radius:12px;background:var(--teal);color:#fff;
  font:800 14px/1 "Inter";padding:10px 16px;cursor:pointer;
}
.chat-input .send-btn:hover,.chat-input button:hover{background:var(--teal-2)}
@media (max-width:520px){.chat-input{flex-direction:column}.chat-input .send-btn,.chat-input button{width:100%}}

/* Disabled state */
.chat-input button[disabled]{opacity:.6;cursor:not-allowed}

/* =================================================================
   FEEDBACK / SCORING
   ================================================================= */
.scoring-panel,.coach-feedback{
  background:#fff;border-top:1px solid var(--line);
  padding:12px 16px 14px;color:var(--ink);
}
.scoring-panel h4,.coach-feedback h4{
  margin:0 0 8px;font:800 14px/1.2 "Inter";color:var(--navy)
}
.score-row{margin:2px 0 8px;font:600 13px/1.35 "Inter";color:#0b3954}

/* Badges line */
.score-badges{
  display:flex;flex-wrap:wrap;gap:6px;margin:6px 0 4px;
}
.score-badges span{
  display:inline-block;background:var(--soft);border:1px solid var(--line);color:#0b3954;
  padding:3px 8px;font:700 12px/1 "Inter";border-radius:999px;white-space:nowrap;
}

/* Optional progress bar */
.progress{
  height:8px;border-radius:6px;background:#eef3f9;border:1px solid var(--line);overflow:hidden;margin:8px 0 0;
}
.progress > i{display:block;height:100%;width:0;background:var(--teal);transition:width .25s ease}

/* =================================================================
   TABLES / LISTS (if bot outputs summaries)
   ================================================================= */
.table{
  width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--line);
  border-radius:12px;overflow:hidden;background:#fff;
}
.table th,.table td{padding:10px 12px;border-bottom:1px solid var(--line);text-align:left}
.table thead th{background:var(--soft-2);font-weight:800;color:var(--navy)}
.table tr:last-child td{border-bottom:none}

/* =================================================================
   TOAST / BANNER (defensive: style if something emits them)
   ================================================================= */
.cw-banner,.cw-toast{
  position:relative;display:block;margin:10px 16px;padding:10px 12px;border-radius:10px;border:1px solid var(--line);
  background:#fbfdff;color:var(--ink);box-shadow:var(--shadow-sm);
}
.cw-banner.warn,.cw-toast.warn{background:var(--warn);border-color:#eadfbb}
.cw-banner.error,.cw-toast.error{background:var(--danger);border-color:#e3b4ad}

/* =================================================================
   BUTTONS / TAGS (utility for content inside bot replies)
   ================================================================= */
.btn-pill{
  display:inline-block;border-radius:999px;padding:6px 12px;border:1px solid var(--line);
  background:#fff;color:var(--ink);font:700 12px/1 "Inter";text-decoration:none;
}
.btn-pill.primary{background:var(--teal);color:#fff;border-color:var(--teal)}
.btn-pill.primary:hover{filter:brightness(.96)}
.kbd{
  display:inline-block;padding:2px 6px;border:1px solid var(--line);border-bottom-width:2px;border-radius:6px;background:#fff;font:600 11px/1 "Inter"
}

/* =================================================================
   LOADER DOTS (if JS toggles .is-loading on send button)
   ================================================================= */
.is-loading::after{
  content:"";display:inline-block;vertical-align:middle;margin-left:8px;
  width:4px;height:4px;border-radius:50%;
  box-shadow:10px 0 0 0 currentColor,20px 0 0 0 currentColor,30px 0 0 0 currentColor;
  animation:coach-dots 1s infinite steps(3,start);
}
@keyframes coach-dots{
  0% {box-shadow:10px 0 0 0 transparent,20px 0 0 0 transparent,30px 0 0 0 currentColor}
  33%{box-shadow:10px 0 0 0 currentColor,20px 0 0 0 transparent,30px 0 0 0 transparent}
  66%{box-shadow:10px 0 0 0 transparent,20px 0 0 0 currentColor,30px 0 0 0 transparent}
  100%{box-shadow:10px 0 0 0 transparent,20px 0 0 0 transparent,30px 0 0 0 currentColor}
}

/* =================================================================
   CARDS INSIDE BOT OUTPUT (recommendations, do/don’t, etc.)
   ================================================================= */
.tip-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
@media (max-width:680px){.tip-grid{grid-template-columns:1fr}}
.tip{
  border:1px solid var(--line);border-radius:12px;background:#fff;padding:10px 12px;box-shadow:var(--shadow-sm)
}
.tip h5{margin:0 0 6px;font:800 13px/1.2 "Inter";color:var(--navy)}
.tip.good{border-color:#bfe7df;background:#f3fcfa}
.tip.bad{border-color:#f3c9c3;background:#fff3f1}

/* =================================================================
   UTILS
   ================================================================= */
.hidden{display:none !important}
.small{font-size:12px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
.center{display:grid;place-items:center}
.pad{padding:var(--pad)}
.round{border-radius:var(--radius)}
.shadow{box-shadow:var(--shadow-sm)}

/* ===== Patch: map site modal to coach styles, and lock typography ===== */

/* 1) Modal + panel aliases for #coachModal */
#coachModal.modal.open { display:grid; place-items:start center; padding:32px 12px; background:rgba(10,18,28,.38); z-index:9999; }
#coachModal .modal-box { width:min(980px,96vw); background:#fff; border:1px solid var(--line); border-radius:var(--radius-lg); box-shadow:var(--shadow); overflow:hidden; }
#coachModal .modal-head { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:12px 16px; background:var(--soft-2); border-bottom:1px solid var(--line); }
#coachModal .modal-title { font:800 18px/1 "Inter"; color:var(--navy); }
#coachModal .modal-close { appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink); border-radius:999px; padding:6px 12px; font-weight:700; cursor:pointer; }
#coachModal .modal-close:hover { background:#f9fbfe; }

/* 2) Contain inherited typography inside the widget only */
#coachBody, #reflectiv-widget { font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif; color:var(--ink); }
#reflectiv-widget p { margin:0 0 .6rem; line-height:1.45; }
#reflectiv-widget ul { margin:.4rem 0 .6rem; padding-left:1.1rem; list-style:disc; }
#reflectiv-widget li { margin:.15rem 0; }
#reflectiv-widget pre, 
#reflectiv-widget code { white-space:pre-wrap; word-break:break-word; overflow-wrap:anywhere; }

/* 3) Prevent message overflow and force wrapping */
#reflectiv-widget .chat-messages { max-height:60vh; overflow:auto; padding:16px 18px; background:#fff; }
#reflectiv-widget .chat-message { margin:0 0 12px; line-height:1.45; color:var(--ink); word-break:break-word; overflow-wrap:anywhere; }
#reflectiv-widget .msg-card { max-width:100%; overflow:hidden; }

/* 4) Defensive: reset any global Tailwind utilities leaking in */
#reflectiv-widget * { box-sizing:border-box; }

/* ---------- OVERRIDES ADDED TO FIX CLIPPING AND MAKE BODY SCROLL ---------- */

/* Make modal content a flex column so body can scroll, footer stays visible */
#coachModal .modal-box {
  display: flex;
  flex-direction: column;
  max-height: 90vh;
  overflow: hidden;
}

/* Scroll the body area only */
#coachBody {
  flex: 1 1 auto;
  min-height: 0;
  overflow-y: auto;
  padding: 0;
}

/* Let the widget message area size naturally; modal controls height and allow full scroll */
#reflectiv-widget .chat-messages {
  min-height: 220px;
  height: auto !important;       /* beats inline style from widget.js */
  max-height: none !important;   /* remove cap */
  overflow-y: auto !important;   /* ensure scrolling */
}

/* =================================================================
   NEW MODULAR WIDGET STYLES
   ================================================================= */

/* Widget wrapper */
.reflectiv-widget-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%;
  min-height: 520px;
}

/* Mode selector */
.mode-selector {
  padding: 12px 16px;
  background: var(--soft-2);
  border-bottom: 1px solid var(--line);
  display: flex;
  align-items: center;
  gap: 8px;
}

.mode-label {
  font: 700 13px/1.2 "Inter";
  color: var(--navy);
}

.mode-select {
  padding: 6px 10px;
  border: 1px solid var(--line);
  border-radius: var(--radius);
  background: #fff;
  font: 400 14px/1.2 "Inter";
  color: var(--ink);
  cursor: pointer;
}

/* Chat container */
.reflectiv-chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 16px;
  background: #fff;
}

/* Message bubbles */
.message-bubble {
  margin-bottom: 12px;
  padding: 12px 14px;
  border-radius: var(--radius);
  line-height: 1.5;
  word-break: break-word;
}

.message-user {
  background: var(--navy);
  color: #fff;
  margin-left: auto;
  max-width: 80%;
}

.message-assistant {
  background: var(--soft);
  color: var(--ink);
  border: 1px solid var(--line);
  max-width: 100%;
}

.message-body {
  margin: 0;
}

.message-time {
  font-size: 11px;
  opacity: 0.7;
  margin-bottom: 4px;
}

.message-metadata {
  font-size: 11px;
  opacity: 0.7;
  margin-top: 6px;
  border-top: 1px solid rgba(0,0,0,0.1);
  padding-top: 6px;
}

/* Typing indicator */
.typing-indicator {
  padding: 12px 14px;
  background: var(--soft);
  border: 1px solid var(--line);
  border-radius: var(--radius);
  display: inline-flex;
  gap: 6px;
  align-items: center;
  margin-bottom: 12px;
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--slate);
  border-radius: 50%;
  animation: typing-pulse 1.4s ease-in-out infinite;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing-pulse {
  0%, 60%, 100% { opacity: 0.3; }
  30% { opacity: 1; }
}

/* Input area */
.reflectiv-input-area {
  padding: 12px 16px;
  background: var(--soft-2);
  border-top: 1px solid var(--line);
  display: flex;
  gap: 8px;
}

.reflectiv-input {
  flex: 1;
  padding: 10px 12px;
  border: 1px solid var(--line);
  border-radius: var(--radius);
  font: 400 14px/1.4 "Inter";
  resize: vertical;
  min-height: 60px;
}

.reflectiv-input:focus {
  outline: none;
  border-color: var(--accent);
}

.reflectiv-send-button {
  padding: 10px 20px;
  background: var(--accent);
  color: #fff;
  border: none;
  border-radius: var(--radius);
  font: 700 14px/1.2 "Inter";
  cursor: pointer;
  transition: opacity 0.2s;
}

.reflectiv-send-button:hover {
  opacity: 0.9;
}

/* Error message */
.error-message {
  padding: 12px 14px;
  background: var(--danger);
  border: 1px solid #ffccc7;
  border-radius: var(--radius);
  margin-bottom: 12px;
}

.error-text {
  color: #c41d1d;
  font-weight: 600;
  margin-bottom: 6px;
}

.error-request-id {
  font-size: 11px;
  color: #999;
  font-family: monospace;
}

.retry-button {
  margin-top: 8px;
  padding: 6px 12px;
  background: #fff;
  border: 1px solid var(--line);
  border-radius: var(--radius);
  font: 600 12px/1.2 "Inter";
  cursor: pointer;
}

.retry-button:hover {
  background: var(--soft);
}

/* Sales Simulation Sections */
.sales-sim-section {
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid var(--line);
}

.sales-sim-section:last-child {
  border-bottom: none;
}

.sales-sim-header {
  font: 800 15px/1.2 "Inter";
  color: var(--navy);
  margin: 0 0 8px 0;
}

.sales-sim-body {
  color: var(--ink);
  line-height: 1.5;
}

.sales-sim-body p {
  margin: 0 0 8px 0;
}

.sales-sim-body p:last-child {
  margin-bottom: 0;
}

.phrasing-suggestion {
  font-style: italic;
  color: #0b3954;
  font-weight: 500;
}

.phrasing-list {
  margin: 8px 0;
  padding-left: 20px;
  list-style: disc;
}

.phrasing-list li {
  margin: 4px 0;
}

/* Warning for partial response */
.sales-sim-warning {
  padding: 10px 12px;
  background: var(--warn);
  border: 1px solid #f0d98e;
  border-radius: var(--radius);
  margin-bottom: 12px;
  font-size: 13px;
}

.sales-sim-missing {
  opacity: 0.6;
}

.missing-placeholder {
  font-style: italic;
  color: var(--slate);
}

/* Other mode renderers */
.emotional-assessment-content,
.product-knowledge-content,
.role-play-content {
  padding: 12px 0;
  line-height: 1.5;
}

/* Section headers (generic) */
.section-header {
  font: 800 14px/1.2 "Inter";
  color: var(--navy);
  margin: 0 0 8px 0;
}

.section {
  margin-bottom: 12px;
}

.section-body {
  color: var(--ink);
  line-height: 1.5;
}
